language: java

jdk: openjdk8

# Execute build in container-based environment.
sudo: false

branches:
  except:
  - gh-pages

env:
  global:
  - ANDROID_HOME=$HOME/android-sdk
  - ANDROID_BUILD_TOOLS=28.0.3
  - ANDROID_SDK=28

# Reset default Travis commands.
install: true
build: true

stages:
- "Install"
- "Build"
- "Lint"
- "Test"
- "Test Coverage"

jobs:
  include:
  - stage: "Install"
    name: "Install SDK"
    script: ./ci/install-sdk
  - stage: "Build"
    name: "Assemble"
    script: ./ci/assemble
  - stage: "Test"
    name: "Lint"
    script: ./ci/lint
  - name: "Unit test"
    script: ./ci/unit-tests
  - name: "Integration test"
    script: ./ci/integration-tests
    env:
      EMULATOR_ANDROID_SDK=28
      EMULATOR_ABI=armeabi-v7a
  - name: "Integration test"
    script: ./ci/integration-tests
    env:
      EMULATOR_ANDROID_SDK=21
      EMULATOR_ABI=armeabi-v7a
  - stage: "Coverage"
    name: "Test coverage"
    script: ./ci/test-coverage

# Use Travis CI's cache management
before_cache:
- rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  # Android SDK
  - $ANDROID_HOME
  # Gradle dependencies
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/
  # Android build cache (see http://tools.android.com/tech-docs/build-cache)
  - $HOME/.android/build-cache
